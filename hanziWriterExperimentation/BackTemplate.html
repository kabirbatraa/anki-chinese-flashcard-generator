{{FrontSide}}

<hr id=answer>

{{Back}}

<div id="test" class="card">template failed to read hanzi</div>
<div class="outerBox">
    <div id="hanziAnimationDiv" style="background-color: #5e5e5e;"></div>
</div>
<!-- <div style="border: 1px solid #CCC; width: 102px; height: 102px">
    <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" id="grid-background-target">
        <line x1="0" y1="0" x2="100" y2="100" stroke="#DDD" />
        <line x1="100" y1="0" x2="0" y2="100" stroke="#DDD" />
        <line x1="50" y1="0" x2="50" y2="100" stroke="#DDD" />
        <line x1="0" y1="50" x2="100" y2="50" stroke="#DDD" />
    </svg>
</div> -->

<!-- dependent of the flashcard -->
<!-- <script src= "我.js"></script>  -->
<!-- <script src= "我.js" type="text/javascript"></script> -->

<!-- slows down the load time drastically: -->
<!-- <script src= "_allCharacters.js" type="text/javascript"></script> -->

<script src="_hanziWriter.js"></script>

<script>
    var characterData = {}
</script>

<!-- load this script dynamically -->
<!-- <script src="我.js"></script> --> 

<script>

// var grid_data = `<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' class='grid-color'  id='grid-background-target'><g id="char_grid"><line x1='0' y1='0' x2='100%' y2='100%' stroke='var(--surface1)' /><line x1='100%' y1='0' x2='0' y2='100%' stroke='var(--surface1)' /><line x1='50%' y1='0' x2='50%' y2='100%' stroke='var(--surface1)' /><line x1='0' y1='50%' x2='100%' y2='50%' stroke='var(--surface1)' /></g></svg>`;
// var span = document.createElement('span');
// span.innerHTML = grid_data;

var hanziCharacters = document.getElementById('hanzi').innerHTML;
if (hanziCharacters == "") hanziCharacters = "我"; // default to wo if the card's <div id="hanzi" style="display:none"> is empty
    // hanziCharacters = "我"; // hardcode for testing

// document.getElementById('test').innerHTML = hanziCharacters + " were read by template";
document.getElementById('test').style.display = "none";
// disable this element (only show if something broke)
    
    
// from 我.js
// let importedCharacterJsonData = JSON.parse(JSON.stringify(characterJsonData))
// let allCharactersData = JSON.parse(JSON.stringify(allCharacters))
// let importedCharacterJsonData = characterJsonData;

/*
var scriptsLoaded = 0;
var totalScripts = hanziCharacters.length;
// let characterData = {}

// this code should load "我.js" in runtime
// var newScript = document.createElement("script");
// newScript.type = "text/javascript";
// newScript.src = "我.js";
// newScript.onload = () => {
//     scriptsLoaded += 1
//     // if (scriptsLoaded == hanziCharacters.length) {
//     //     drawCharacters()
//     // }
//     drawCharacters()
// }
// document.body.appendChild(newScript);

// create a new script for each character
// once the last character's script has been loaded, call drawCharacters()
for (var character of hanziCharacters) {
    var newScript = document.createElement("script");
    newScript.type = "text/javascript";
    newScript.src = "stroke_data_" + character + ".js";
    newScript.onload = () => {
        scriptsLoaded += 1
        if (scriptsLoaded == totalScripts) {
            drawCharacters()
        }
    }
    document.body.appendChild(newScript);
}
*/

// each character should have a div like this:
// <div id="{character}">{strokeJsonData}</div>'
for (var character of hanziCharacters) {
    var jsonDiv = document.getElementById(character);
    characterData[character] = JSON.parse(jsonDiv.innerHTML);
}
drawCharacters();


// drawCharacters();

function drawCharacters() {

    // at this point, all scripts for the hanzi characters should have loaded
    // characterData["insert chinese character"] will give the json data

    
    var characters = hanziCharacters.split("")
    for (x of characters) {
        var writer = HanziWriter.create('hanziAnimationDiv', x, {
            charDataLoader: function() {
                return characterData[x];
            },
            width: 80,
            height: 80,
            padding: 5,   
            showOutline: true,
            strokeAnimationSpeed: 1, 
            delayBetweenStrokes: 150, // milliseconds
            outlineColor: '#1e1e1e', // background outline, dark gray
            strokeColor: '#e4e4e4', // off color white
            radicalColor: '#bb86fc' // purple ish
        });
        writer.loopCharacterAnimation();
    };

}




// var characters = hanziCharacters.split("")
// var js = document.createElement("script");
// 	js.type = "text/javascript";
// 	js.src = "https://cdn.jsdelivr.net/npm/hanzi-writer@2.2/dist/hanzi-writer.min.js";
// 	js.onload = function() {
// 		for (x of characters) {
// 			var writer = HanziWriter.create('target', x, {
// 				width: 70,
// 				height: 70,
// 				padding: 5,   
// 				showOutline: true,
// 				strokeAnimationSpeed: 1, 
// 				delayBetweenStrokes: 150, // milliseconds
// 				radicalColor: '#337ab7' // blue
// 			});
// 			writer.loopCharacterAnimation();
// 		};
// 	};
// 	document.body.appendChild(js);

</script>
